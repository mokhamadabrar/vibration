<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Kalkulator A(8) & Safe Work Practice ‚Äì EU Vibration</title>
<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<style>
  :root{
    /* Palet lembut (screen) */
    --bg1:#0f172a; --bg2:#111827;
    --card:#111827;
    --ink:#e5e7eb;
    --muted:#b6c1d6;
    --accent:#7dd3fc;
    --ok:#86efac; --warn:#facc15; --bad:#fb7185;
    --br:16px;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    color:var(--ink);
    background:linear-gradient(180deg,var(--bg1),var(--bg2));
  }
  header{padding:22px 16px 8px;text-align:center}
  header h1{margin:0 0 6px;font-weight:700;letter-spacing:.2px}
  header p{margin:0;color:var(--muted)}
  .wrap{max-width:1100px;margin:18px auto 40px;padding:0 16px}
  .toolbar{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin:8px 0 16px}
  .btn{cursor:pointer;padding:10px 14px;border-radius:10px;border:1px solid rgba(255,255,255,.18);background:#0e1530;color:var(--ink)}
  .btn:hover{border-color:var(--accent)}
  select{padding:10px;border-radius:10px;background:#0b1326;color:var(--ink);border:1px solid rgba(255,255,255,.18)}
  .card{
    background:linear-gradient(180deg,#121a2f,#0f162b);
    border:1px solid rgba(255,255,255,.06);
    border-radius:var(--br);
    padding:18px;
    box-shadow:0 10px 30px rgba(0,0,0,.35);
    margin-bottom:14px
  }
  .grid{display:grid;gap:14px}
  @media(min-width:980px){ .grid{grid-template-columns:1.08fr 1.12fr}}
  label{display:block;font-size:14px;color:var(--muted);margin-bottom:6px}
  input[type=number]{width:100%;padding:10px 12px;background:#0b1326;border:1px solid rgba(255,255,255,.12);color:var(--ink);border-radius:10px;outline:none}
  input[type=number]:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(125,211,252,.18)}
  .row{display:grid;gap:12px;grid-template-columns:repeat(4,1fr)}
  @media(max-width:720px){ .row{grid-template-columns:1fr}}
  .hint{font-size:12px;color:var(--muted)}
  .stat{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;background:#0e1733;border:1px solid rgba(255,255,255,.08);border-radius:12px;margin:8px 0}
  .stat b{font-size:18px}
  .pill{padding:4px 8px;border-radius:999px;font-size:12px;border:1px solid rgba(255,255,255,.15);color:var(--muted)}
  .ok{color:var(--ok);border-color:rgba(134,239,172,.35)}
  .warn{color:var(--warn);border-color:rgba(250,204,21,.35)}
  .bad{color:var(--bad);border-color:rgba(251,113,133,.35)}
  h2{margin:10px 0 8px}
  h3{margin:8px 0 6px}
  ul{margin:8px 0 0 18px}
  table{width:100%;border-collapse:separate;border-spacing:0;overflow:hidden;border-radius:12px;margin-top:8px}
  th,td{padding:10px 12px;text-align:left;border-bottom:1px solid rgba(255,255,255,.08)}
  th{font-weight:600;color:var(--muted);background:#101a36;position:sticky;top:0}
  tr:last-child td{border-bottom:none}
  .small{font-size:12px;color:var(--muted)}
  .chartbox{width:100%;height:clamp(220px,36vw,320px)}
  canvas{width:100%!important;height:100%!important;background:#0f1a36;border-radius:12px;padding:8px}
  footer{max-width:1100px;margin:20px auto 60px;color:var(--muted);text-align:center;padding:0 16px}
  footer a{color:var(--accent);text-decoration:none}
  footer a:hover{text-decoration:underline}

  /* ==== PRINT FIXES ==== */
  @media print{
    /* pastikan semua teks terbaca */
    *{
      background:transparent !important;
      color:#000 !important;
      box-shadow:none !important;
      -webkit-print-color-adjust:exact;
      print-color-adjust:exact;
    }
    body{background:#fff !important}
    header p, .hint{color:#000 !important}
    .card, .stat, table, th, td{background:#fff !important; color:#000 !important; border-color:#000 !important}
    .pill{border-color:#000 !important; color:#000 !important; background:transparent !important}
    /* jadikan chart persegi dan tajam */
    .chartbox{height:auto !important}
    canvas{
      width:140mm !important;   /* persegi untuk A4 portrait */
      height:140mm !important;  /* hindari ‚Äúmelonjong‚Äù */
      background:#fff !important;
      padding:0 !important;
      border-radius:0 !important;
    }
    footer a{color:#000 !important}
  }
</style>
</head>
<body>
<header>
  <h1 id="t_title">Kalkulator A(8) & Safe Work Practice (EU 2002/44/EC)</h1>
  <p id="t_sub">Rumus: <span style="font-family:ui-monospace">A(8) = a‚Çï·µ• ¬∑ ‚àö(T / 8)</span>, T dalam jam; normalisasi ke 8 jam</p>
</header>

<div class="toolbar">
  <button class="btn" id="btnPrint">üñ®Ô∏è Print PDF</button>
  <label class="small" for="langSel" id="t_langlabel">Bahasa:</label>
  <select id="langSel">
    <option value="id">Indonesia (ID)</option>
    <option value="en">English (EN)</option>
  </select>
</div>

<div class="wrap">
  <div class="card grid">
    <div>
      <h2 id="t_inputs">Input</h2>
      <label for="ahv" id="t_ahvlabel">a‚Çï·µ• (m/s¬≤) ‚Äì RMS alat</label>
      <input id="ahv" type="number" step="0.01" min="0" value="2.50" />
      <div class="hint" id="t_ahvhint">Contoh: 2.50 m/s¬≤ (A(8) = 2.5 jika 8 jam penuh)</div>

      <div class="row" style="margin-top:10px">
        <div>
          <label for="targetA" id="t_targetlabel">Target A(8) (m/s¬≤)</label>
          <input id="targetA" type="number" step="0.01" min="0" value="2.20" />
          <div class="hint" id="t_targethint">Disarankan &lt; 2.50 sebagai margin aman</div>
        </div>
        <div>
          <label for="shiftH" id="t_shiftlabel">Durasi shift (jam)</label>
          <input id="shiftH" type="number" step="0.5" min="1" value="8" />
          <div class="hint" id="t_shifthint">Paparan ‚â§ durasi shift; A(8) tetap dinormalisasi 8 jam</div>
        </div>
        <div>
          <label for="toolHours" id="t_toolhlabel">Total jam alat/hari</label>
          <input id="toolHours" type="number" step="0.25" min="0" value="8" />
          <div class="hint" id="t_toolhhint">Untuk hitung operator minimum (rotasi)</div>
        </div>
        <div style="display:flex;align-items:end"><button class="btn" id="btnCalc">Hitung</button></div>
      </div>

      <div class="stat">
        <span id="t_a8fulltxt">Jika dipakai terus sepanjang shift, A(8) = <b id="a8full">‚Äî</b></span>
        <span class="pill" id="statusPill">‚Äî</span>
      </div>
      <div class="stat">
        <span id="t_tmax8txt">Durasi paparan maksimum (target, basis 8 jam): <b id="tmax8">‚Äî</b> jam</span>
        <span class="pill ok" id="t_targetpill">Target-based</span>
      </div>
      <div class="stat">
        <span id="t_tmaxlimtxt">Batas paparan dibatasi shift: <b id="tmaxLimited">‚Äî</b> jam</span>
        <span class="pill" id="t_shiftpill">Shift limit</span>
      </div>
      <div class="stat">
        <span id="t_perhourtxt">Rekomendasi per jam: <b id="perHour">‚Äî</b> (kerja + jeda)</span>
        <span class="pill" id="t_dutypill">Duty cycle</span>
      </div>
      <div class="stat">
        <span id="t_opsneedtxt">Kebutuhan operator (min): <b id="opsNeeded">‚Äî</b></span>
        <span class="pill" id="t_rotpill">Rotasi</span>
      </div>
    </div>

    <div>
      <h2 id="t_opts">Opsi Jadwal & A(8)</h2>
      <div class="small" id="t_presethint">Tambah baris: Work‚Ä≤ + Break‚Ä≤ per jam</div>
      <div style="margin:.5rem 0" class="flex">
        <button class="btn" id="btnAddPreset">+ Preset Kustom</button>
      </div>
      <table id="schedTable">
        <thead>
          <tr>
            <th id="t_colScheme">Skema per jam</th>
            <th>Duty</th>
            <th id="t_colT">T (jam/hari)</th>
            <th>A(8) (m/s¬≤)</th>
            <th id="t_colStatus">Status</th>
            <th></th>
          </tr>
        </thead>
        <tbody><!-- rows --></tbody>
      </table>
      <div class="small" style="margin-top:6px" id="t_dutydef">
        Duty = menit kerja per jam / 60. T efektif = duty √ó durasi shift (‚â§ shift). A(8)=a‚Çï·µ•¬∑‚àö(T/8).
      </div>
    </div>
  </div>

  <div class="card grid">
    <div>
      <h3 id="t_chart1title">Chart: Work vs Break per Jam</h3>
      <div class="chartbox"><canvas id="chartWB"></canvas></div>
    </div>
    <div>
      <h3 id="t_chart2title">Chart: A(8) vs Durasi Shift</h3>
      <div class="chartbox"><canvas id="chartA8"></canvas></div>
      <div class="small" id="t_chart2hint">Kurva dihitung untuk duty aktif terpilih & a‚Çï·µ• saat ini</div>
    </div>
  </div>

  <div class="card">
    <h2 id="t_sec1">1. Durasi Kerja & Jeda (Vibration Breaks)</h2>
    <p id="t_sec1p">
      Gunakan rekomendasi per jam di atas untuk mengatur blok kerja. Jeda = tugas non-vibration
      (administrasi, inspeksi visual, housekeeping, briefing). Untuk lingkungan panas/kerja berat,
      pilih duty lebih rendah untuk ergonomi.
    </p>
    <ul id="t_sec1ulExtra">
      <li id="t_workdur">Berapa lama durasi bekerja: <b id="wbWorkMin">‚Äî</b> menit</li>
      <li id="t_breakdur">Berapa lama durasi break: <b id="wbBreakMin">‚Äî</b> menit</li>
    </ul>
  </div>

  <div class="card">
    <h2 id="t_sec2">2. Rotasi Pekerja (Work Rotation)</h2>
    <p id="t_sec2p">
      Jika beban kerja total &gt; 8 jam per hari, bagi ke beberapa orang. Minimum operator =
      <span style="font-family:ui-monospace">ceil(TotalToolHours / T<sub>max</sub>)</span>.
    </p>
    <ul id="rotDynamic">
      <li id="t_rotExample1">Contoh: Pekerjaan total alat <b id="rotToolHours">‚Äî</b> jam/hari ‚Üí minimal <b id="rotOps">‚Äî</b> operator</li>
      <li id="t_rotExample2">Rotasi blok: <b id="rotWork">‚Äî</b> menit kerja ‚Üí <b id="rotBreak">‚Äî</b> menit jeda ‚Üí berganti operator maka blok berikutnya</li>
    </ul>
  </div>

  <div class="card">
    <h2 id="t_sec3">3. Engineering Controls</h2>
    <ul id="t_sec3ul">
      <li>Gunakan model alat <em>low-vibration</em> & pegangan anti-vibration bawaan pabrik.</li>
      <li>Perawatan: balancing, alignment, penggantian bearing/brush; getaran naik saat komponen aus.</li>
      <li>Isolasi jalur transmisi: mounting elastomer/damper, atau sistem peredam aktif pada alat berat.</li>
    </ul>
  </div>

  <div class="card">
    <h2 id="t_sec4">4. Administrative Controls</h2>
    <ul id="t_sec4ul">
      <li>Jadwalkan pekerjaan tinggi getaran di jam awal saat kondisi fisik optimal.</li>
      <li>Hindari penugasan berturut-turut durasi penuh pada hari berikutnya untuk tugas yang sama.</li>
      <li>Catat durasi paparan harian per operator; audit bulanan kepatuhan duty/jeda.</li>
    </ul>
  </div>

  <div class="card">
    <h2 id="t_sec5">5. Pelatihan & Teknik Kerja</h2>
    <ul id="t_sec5ul">
      <li>Genggam ringan‚Äîhindari menekan alat berlebihan; biarkan sistem redam bekerja.</li>
      <li>Gunakan dua tangan bila memungkinkan; jaga postur untuk mengurangi transmisi ke lengan.</li>
      <li>Pilih aksesori/pisau/mata bor tajam & sesuai material untuk mengurangi gaya dorong.</li>
    </ul>
  </div>

  <div class="card">
    <h2 id="t_sec6">6. Rekomendasi PPE</h2>
    <ul id="t_sec6ul">
      <li>Sarung tangan anti-vibration (EN ISO 10819) ‚Äî efek terbatas di frekuensi rendah.</li>
      <li>Grip/handle ergonomis untuk menurunkan gaya genggam & slip.</li>
    </ul>
  </div>

  <div class="card">
    <h2 id="t_sec7">7. Monitoring & Evaluasi</h2>
    <ul id="t_sec7ul">
      <li>Ukur ulang getaran tiap 6‚Äì12 bulan atau pasca modifikasi alat/proses.</li>
      <li>Rekalkulasi A(8) bila ada perubahan alat, material, atau metode kerja.</li>
      <li>Investigasi bila A(8) mendekati EAV (2,5 m/s¬≤) atau melebihi target internal.</li>
    </ul>
    <p class="small" id="t_foot">Ambang EU: EAV = 2,5 m/s¬≤; ELV = 5,0 m/s¬≤. Hierarki kontrol: Engineering &gt; Administrative &gt; PPE.</p>
  </div>
</div>

<footer>
  <div>Created by</div>
  <div>HTML design by Abrar</div>
  <div>Turner &amp; Towsand Indonesia</div>
  <div style="margin-top:8px"><a href="https://mokhamadabrar.github.io/vibration/exposureSIM.html" target="_blank" rel="noopener">GitHub Pages: exposureSIM.html</a></div>
</footer>

<script>
/*** i18n ***/
const T = {
  id:{title:"Kalkulator A(8) & Safe Work Practice (EU 2002/44/EC)",sub:"Rumus: A(8) = a‚Çï·µ• ¬∑ ‚àö(T / 8), T dalam jam; normalisasi ke 8 jam",
    langlabel:"Bahasa:",inputs:"Input",ahvlabel:"a‚Çï·µ• (m/s¬≤) ‚Äì RMS alat",ahvhint:"Contoh: 2.50 m/s¬≤ (A(8) = 2.5 jika 8 jam penuh)",
    targetlabel:"Target A(8) (m/s¬≤)",targethint:"Disarankan < 2.50 sebagai margin aman",
    shiftlabel:"Durasi shift (jam)",shifthint:"Paparan ‚â§ durasi shift; A(8) tetap dinormalisasi 8 jam",
    toolhlabel:"Total jam alat/hari",toolhhint:"Untuk hitung operator minimum (rotasi)",
    a8fulltxt:"Jika dipakai terus sepanjang shift, A(8) = ",tmax8txt:"Durasi paparan maksimum (target, basis 8 jam): ",
    tmaxlimtxt:"Batas paparan dibatasi shift: ",perhourtxt:"Rekomendasi per jam: ",opsneedtxt:"Kebutuhan operator (min): ",
    opts:"Opsi Jadwal & A(8)",presethint:"Tambah baris: Work‚Ä≤ + Break‚Ä≤ per jam",colScheme:"Skema per jam",colT:"T (jam/hari)",
    colStatus:"Status",dutydef:"Duty = menit kerja per jam / 60. T efektif = duty √ó durasi shift (‚â§ shift). A(8)=a‚Çï·µ•¬∑‚àö(T/8).",
    chart1title:"Chart: Work vs Break per Jam",chart2title:"Chart: A(8) vs Durasi Shift",chart2hint:"Kurva dihitung untuk duty aktif terpilih & a‚Çï·µ• saat ini",
    s1:"1. Durasi Kerja & Jeda (Vibration Breaks)",s1p:"Gunakan rekomendasi per jam di atas untuk mengatur blok kerja. Jeda = tugas non-vibration (administrasi, inspeksi visual, housekeeping, briefing). Untuk lingkungan panas/kerja berat, pilih duty lebih rendah untuk ergonomi.",
    s1ulExtra_work:"Berapa lama durasi bekerja: ",s1ulExtra_break:"Berapa lama durasi break: ",
    s2:"2. Rotasi Pekerja (Work Rotation)",s2p:"Jika beban kerja total > 8 jam per hari, bagi ke beberapa orang. Minimum operator = ceil(TotalToolHours / T_max).",
    rotExample1_prefix:"Contoh: Pekerjaan total alat ",rotExample1_mid:" jam/hari ‚Üí minimal ",rotExample1_suf:" operator",
    rotExample2_prefix:"Rotasi blok: ",rotExample2_mid:" menit kerja ‚Üí ",rotExample2_suf:" menit jeda ‚Üí berganti operator maka blok berikutnya",
    s3:"3. Engineering Controls",s3ul:["Gunakan model alat low-vibration & pegangan anti-vibration bawaan pabrik.","Perawatan: balancing, alignment, penggantian bearing/brush; getaran naik saat komponen aus.","Isolasi jalur transmisi: mounting elastomer/damper, atau sistem peredam aktif pada alat berat."],
    s4:"4. Administrative Controls",s4ul:["Jadwalkan pekerjaan tinggi getaran di jam awal saat kondisi fisik optimal.","Hindari penugasan berturut-turut durasi penuh pada hari berikutnya untuk tugas yang sama.","Catat durasi paparan harian per operator; audit bulanan kepatuhan duty/jeda."],
    s5:"5. Pelatihan & Teknik Kerja",s5ul:["Genggam ringan‚Äîhindari menekan alat berlebihan; biarkan sistem redam bekerja.","Gunakan dua tangan bila memungkinkan; jaga postur untuk mengurangi transmisi ke lengan.","Pilih aksesori/pisau/mata bor tajam & sesuai material untuk mengurangi gaya dorong."],
    s6:"6. Rekomendasi PPE",s6ul:["Sarung tangan anti-vibration (EN ISO 10819) ‚Äî efek terbatas di frekuensi rendah.","Grip/handle ergonomis untuk menurunkan gaya genggam & slip."],
    s7:"7. Monitoring & Evaluasi",s7ul:["Ukur ulang getaran tiap 6‚Äì12 bulan atau pasca modifikasi alat/proses.","Rekalkulasi A(8) bila ada perubahan alat, material, atau metode kerja.","Investigasi bila A(8) mendekati EAV (2,5 m/s¬≤) atau melebihi target internal."],
    foot:"Ambang EU: EAV = 2,5 m/s¬≤; ELV = 5,0 m/s¬≤. Hierarki kontrol: Engineering > Administrative > PPE.",
    pills:{below:"Di bawah EAV", at:"Tepat EAV", between:"Antara EAV‚ÄìELV", above:"Di atas ELV!", target:"Berbasis target", shift:"Batas shift", duty:"Duty cycle", rot:"Rotasi"}
  },
  en:{title:"A(8) Calculator & Safe Work Practice (EU 2002/44/EC)",sub:"Formula: A(8) = a‚Çï·µ• ¬∑ ‚àö(T / 8), T in hours; normalized to 8 h",
    langlabel:"Language:",inputs:"Inputs",ahvlabel:"a‚Çï·µ• (m/s¬≤) ‚Äì tool RMS",ahvhint:"Example: 2.50 m/s¬≤ (A(8) equals 2.5 if used for full 8 h)",
    targetlabel:"Target A(8) (m/s¬≤)",targethint:"Recommended < 2.50 as a safety margin",
    shiftlabel:"Shift duration (h)",shifthint:"Exposure time ‚â§ shift; A(8) normalized to 8 h",
    toolhlabel:"Tool hours/day (total)",toolhhint:"For minimum operators (rotation)",
    a8fulltxt:"If used continuously for the whole shift, A(8) = ",tmax8txt:"Max exposure for target (8-h basis): ",
    tmaxlimtxt:"Exposure limited by shift: ",perhourtxt:"Per-hour recommendation: ",opsneedtxt:"Operators needed (min): ",
    opts:"Schedule Options & A(8)",presethint:"Add row: Work‚Ä≤ + Break‚Ä≤ per hour",colScheme:"Per-hour scheme",colT:"T (h/day)",
    colStatus:"Status",dutydef:"Duty = work minutes per hour / 60. Effective T = duty √ó shift (‚â§ shift). A(8)=a‚Çï·µ•¬∑‚àö(T/8).",
    chart1title:"Chart: Work vs Break per Hour",chart2title:"Chart: A(8) vs Shift Length",chart2hint:"Curve computed for current duty & a‚Çï·µ•",
    s1:"1. Work & Break Duration (Vibration Breaks)",s1p:"Use the per-hour recommendation above to block the task. Breaks = non-vibration tasks (admin, visual inspection, housekeeping, briefing). For hot/heavy work, choose a lower duty for ergonomics.",
    s1ulExtra_work:"Work duration: ",s1ulExtra_break:"Break duration: ",
    s2:"2. Worker Rotation",s2p:"If total workload exceeds 8 h/day, split across workers. Minimum operators = ceil(TotalToolHours / T_max).",
    rotExample1_prefix:"Example: Total tool time ",rotExample1_mid:" h/day ‚Üí at least ",rotExample1_suf:" operators",
    rotExample2_prefix:"Block rotation: ",rotExample2_mid:" min work ‚Üí ",rotExample2_suf:" min break ‚Üí switch operator then next block",
    s3:"3. Engineering Controls",s3ul:["Use low-vibration models & OEM anti-vibration handles.","Maintenance: balancing, alignment, bearing/brush replacement; vibration rises with wear.","Isolate transmission: elastomer mounts/dampers, or active damping on heavy equipment."],
    s4:"4. Administrative Controls",s4ul:["Schedule high-vibration tasks early when workers are fresh.","Avoid back-to-back full-shift assignments on consecutive days.","Log daily exposure per worker; audit duty/break compliance monthly."],
    s5:"5. Training & Technique",s5ul:["Light grip‚Äîavoid excessive push; let damping work.","Use two hands where possible; maintain posture to reduce transmission.","Sharp & suitable accessories (bits/blades) to reduce required push force."],
    s6:"6. PPE Recommendations",s6ul:["Anti-vibration gloves (EN ISO 10819) ‚Äî limited effect at low frequencies.","Ergonomic grips/handles to reduce grip force & slip."],
    s7:"7. Monitoring & Evaluation",s7ul:["Re-measure vibration every 6‚Äì12 months or after modifications.","Recompute A(8) when tools, materials, or methods change.","Investigate when A(8) nears EAV (2.5 m/s¬≤) or exceeds internal targets."],
    foot:"EU thresholds: EAV = 2.5 m/s¬≤; ELV = 5.0 m/s¬≤. Control hierarchy: Engineering > Administrative > PPE.",
    pills:{below:"Below EAV", at:"At EAV", between:"Between EAV‚ÄìELV", above:"Above ELV!", target:"Target-based", shift:"Shift limit", duty:"Duty cycle", rot:"Rotation"}
  }
};

function setLang(newLang){
  lang=newLang;
  const L=T[lang]; if(!L) return;
  document.documentElement.lang = (lang==='en'?'en':'id');
  const set = (id, txt)=>{ const el=document.getElementById(id); if(!el) return; if(Array.isArray(txt)){ el.innerHTML = txt.map(li=>`<li>${li}</li>`).join(''); } else { el.innerHTML = txt; } };
  set('t_title', L.title); set('t_sub', L.sub); set('t_langlabel', L.langlabel);
  set('t_inputs', L.inputs); set('t_ahvlabel', L.ahvlabel); set('t_ahvhint', L.ahvhint);
  set('t_targetlabel', L.targetlabel); set('t_targethint', L.targethint);
  set('t_shiftlabel', L.shiftlabel); set('t_shifthint', L.shifthint);
  set('t_toolhlabel', L.toolhlabel); set('t_toolhhint', L.toolhhint);
  set('t_a8fulltxt', L.a8fulltxt + `<b id="a8full">‚Äî</b>`);
  set('t_tmax8txt', L.tmax8txt + `<b id="tmax8">‚Äî</b> ` + (lang==='id'?'jam':'h'));
  set('t_tmaxlimtxt', L.tmaxlimtxt + `<b id="tmaxLimited">‚Äî</b> ` + (lang==='id'?'jam':'h'));
  set('t_perhourtxt', L.perhourtxt + `<b id="perHour">‚Äî</b> (kerja + jeda)`);
  set('t_opsneedtxt', L.opsneedtxt + `<b id="opsNeeded">‚Äî</b>`);
  set('t_opts', L.opts); set('t_presethint', L.presethint);
  set('t_colScheme', L.colScheme); set('t_colT', L.colT); set('t_colStatus', L.colStatus);
  set('t_dutydef', L.dutydef);
  set('t_chart1title', L.chart1title); set('t_chart2title', L.chart2title); set('t_chart2hint', L.chart2hint);
  set('t_sec1', L.s1); set('t_sec1p', L.s1p);
  set('t_sec2', L.s2); set('t_sec2p', L.s2p);
  set('t_sec3', L.s3); set('t_sec3ul', L.s3ul);
  set('t_sec4', L.s4); set('t_sec4ul', L.s4ul);
  set('t_sec5', L.s5); set('t_sec5ul', L.s5ul);
  set('t_sec6', L.s6); set('t_sec6ul', L.s6ul);
  set('t_sec7', L.s7); set('t_sec7ul', L.s7ul);
  set('t_foot', L.foot);

  // label dinamis
  document.getElementById('t_workdur').childNodes[0].nodeValue = L.s1ulExtra_work;
  document.getElementById('t_breakdur').childNodes[0].nodeValue = L.s1ulExtra_break;

  updateRotationLabels();
  recalc();
}
function updateRotationLabels(){
  const L=T[lang];
  document.getElementById('t_rotExample1').innerHTML =
    `${L.rotExample1_prefix}<b id="rotToolHours">‚Äî</b>${L.rotExample1_mid}<b id="rotOps">‚Äî</b>${L.rotExample1_suf}`;
  document.getElementById('t_rotExample2').innerHTML =
    `${L.rotExample2_prefix}<b id="rotWork">‚Äî</b>${L.rotExample2_mid}<b id="rotBreak">‚Äî</b>${L.rotExample2_suf}`;
}
function pillText(a8){
  const P=T[lang].pills;
  if(!isFinite(a8)) return {text:"‚Äî", cls:"pill"};
  if(a8 < 2.5) return {text:P.below, cls:"pill ok"};
  if(Math.abs(a8-2.5)<1e-9) return {text:P.at, cls:"pill warn"};
  if(a8 > 5.0) return {text:P.above, cls:"pill bad"};
  return {text:P.between, cls:"pill warn"};
}
function fmt(x,d=2){ if(!isFinite(x)) return "‚Äî"; return Number(x).toFixed(d); }

/*** Presets ***/
const defaultPresets = [
  {work:60, break:0,  labelID:"60‚Ä≤ kerja + 0‚Ä≤ jeda (kontinu)", labelEN:"60‚Ä≤ work + 0‚Ä≤ break (continuous)"},
  {work:50, break:10, labelID:"50‚Ä≤ kerja + 10‚Ä≤ jeda", labelEN:"50‚Ä≤ work + 10‚Ä≤ break"},
  {work:45, break:15, labelID:"45‚Ä≤ kerja + 15‚Ä≤ jeda", labelEN:"45‚Ä≤ work + 15‚Ä≤ break"},
  {work:40, break:20, labelID:"40‚Ä≤ kerja + 20‚Ä≤ jeda", labelEN:"40‚Ä≤ work + 20‚Ä≤ break"},
  {work:30, break:30, labelID:"30‚Ä≤ kerja + 30‚Ä≤ jeda", labelEN:"30‚Ä≤ work + 30‚Ä≤ break"},
  {work:20, break:40, labelID:"20‚Ä≤ kerja + 40‚Ä≤ jeda", labelEN:"20‚Ä≤ work + 40‚Ä≤ break"}
];
let customPresets = [];

/*** Charts ***/
let chartWB, chartA8;
/* plugin: isi background putih saat render agar PDF jelas */
const whiteBG = {
  id:'whiteBG',
  beforeDraw:(chart, args, opts)=>{
    const {ctx, chartArea} = chart;
    if(!chartArea) return;
    ctx.save();
    ctx.fillStyle = opts?.color || '#ffffff';
    ctx.fillRect(chartArea.left, chartArea.top, chartArea.right-chartArea.left, chartArea.bottom-chartArea.top);
    ctx.restore();
  }
};
function buildCharts(){
  const ctx1=document.getElementById('chartWB');
  if(chartWB) chartWB.destroy();
  chartWB = new Chart(ctx1, {
    type:'doughnut',
    data:{labels:['Work','Break'], datasets:[{data:[50,10]}]},
    options:{
      responsive:true, maintainAspectRatio:false,
      plugins:{legend:{position:'bottom'}, whiteBG:{}}
    },
    plugins:[whiteBG]
  });
  const ctx2=document.getElementById('chartA8');
  if(chartA8) chartA8.destroy();
  chartA8 = new Chart(ctx2, {
    type:'line',
    data:{labels:[], datasets:[{label:'A(8)', data:[], tension:0.25, pointRadius:2}]},
    options:{
      responsive:true, maintainAspectRatio:false,
      plugins:{legend:{display:false}, whiteBG:{}},
      scales:{
        x:{title:{display:true,text:'Shift (h)'}},
        y:{title:{display:true,text:'A(8) (m/s¬≤)'}}
      }
    },
    plugins:[whiteBG]
  });
}

/*** PRINT: paksa persegi & tajam saat print; kembalikan setelah print ***/
let prevStates = {};
function beforePrint(){
  // Naikkan DPI untuk ketajaman
  const oldDPR = Chart.defaults.devicePixelRatio;
  prevStates.dpr = oldDPR;
  Chart.defaults.devicePixelRatio = 2;

  // ubah opsi agar aspect ratio dipertahankan
  [chartWB, chartA8].forEach(ch=>{
    if(!ch) return;
    prevStates[ch.id] = { mar: ch.options.maintainAspectRatio };
    ch.options.maintainAspectRatio = true;
    ch.resize(600,600); // paksa persegi (akan ditimpa CSS print juga)
    ch.update();
  });
}
function afterPrint(){
  // kembalikan DPI & opsi
  if(typeof prevStates.dpr!=='undefined'){
    Chart.defaults.devicePixelRatio = prevStates.dpr;
  }
  [chartWB, chartA8].forEach(ch=>{
    if(!ch) return;
    ch.options.maintainAspectRatio = false;
    ch.resize(); ch.update();
  });
  prevStates = {};
}
window.addEventListener('beforeprint', beforePrint);
window.addEventListener('afterprint', afterPrint);

/*** Core calc ***/
function recalc(){
  const ahv = parseFloat(document.getElementById('ahv').value);
  let targetA = parseFloat(document.getElementById('targetA').value);
  const shiftH = parseFloat(document.getElementById('shiftH').value);
  const toolHours = parseFloat(document.getElementById('toolHours').value);
  if(!isFinite(targetA) || targetA <= 0){ targetA = 2.20; document.getElementById('targetA').value = targetA; }

  const Tfull = shiftH;
  const a8full = ahv * Math.sqrt(Tfull/8);
  const pill = pillText(a8full);
  document.getElementById('a8full').textContent = fmt(a8full,2);
  const pillEl = document.getElementById('statusPill'); pillEl.textContent=pill.text; pillEl.className=pill.cls;

  const Tmax8 = 8 * Math.pow(targetA/ahv, 2);
  const TmaxLimited = Math.min(Tmax8, shiftH);
  document.getElementById('tmax8').textContent = fmt(Tmax8,2);
  document.getElementById('tmaxLimited').textContent = fmt(TmaxLimited,2);

  const duty = (shiftH>0)? (TmaxLimited/shiftH) : 0;
  const workMin = Math.round(60*duty);
  const breakMin = Math.max(0, 60 - workMin);
  document.getElementById('perHour').textContent = `${workMin}‚Ä≤ + ${breakMin}‚Ä≤`;
  document.getElementById('wbWorkMin').textContent = workMin;
  document.getElementById('wbBreakMin').textContent = breakMin;

  let opsNeeded = "‚Äî";
  if(isFinite(toolHours) && toolHours>0 && TmaxLimited>0){
    opsNeeded = Math.ceil(toolHours / TmaxLimited);
  }
  document.getElementById('opsNeeded').textContent = opsNeeded;
  document.getElementById('rotToolHours').textContent = isFinite(toolHours)? fmt(toolHours,2) : '‚Äî';
  document.getElementById('rotOps').textContent = opsNeeded;
  document.getElementById('rotWork').textContent = workMin;
  document.getElementById('rotBreak').textContent = breakMin;

  const rows=[...defaultPresets, ...customPresets];
  const tbody=document.querySelector('#schedTable tbody');
  tbody.innerHTML="";
  rows.forEach((p, idx)=>{
    const dutyRow = p.work/60;
    const T = dutyRow * shiftH;
    const A8 = ahv * Math.sqrt(T/8);
    const st = pillText(A8);
    const label = (lang==='id' ? (p.labelID || `${p.work}‚Ä≤ kerja + ${p.break}‚Ä≤ jeda`) :
                               (p.labelEN || `${p.work}‚Ä≤ work + ${p.break}‚Ä≤ break`));
    const tr=document.createElement('tr');
    tr.innerHTML = `
      <td>${label}</td>
      <td>${Math.round(dutyRow*100)}%</td>
      <td>${fmt(T,2)}</td>
      <td>${fmt(A8,2)}</td>
      <td><span class="${st.cls}">${st.text}</span></td>
      <td>${idx>=defaultPresets.length ? `<button class="btn btn-del" data-idx="${idx}">üóë</button>` : ''}</td>
    `;
    tbody.appendChild(tr);
  });

  // update charts
  chartWB.data.datasets[0].data=[workMin, breakMin];
  chartWB.data.labels = (lang==='id')?['Kerja','Jeda']:['Work','Break'];
  chartWB.update();

  const xs=[], ys=[];
  for(let sh=4; sh<=16; sh+=0.5){
    const T = duty * sh;
    const a8 = ahv * Math.sqrt(T/8);
    xs.push(sh.toFixed(1)); ys.push(+a8.toFixed(3));
  }
  chartA8.data.labels=xs;
  chartA8.data.datasets[0].data=ys;
  chartA8.update();
}

/*** Preset CRUD ***/
function addPreset(){
  const w = prompt(lang==='id'?'Menit kerja per jam (0‚Äì60)':'Work minutes per hour (0‚Äì60)', '45');
  if(w===null) return;
  const b = prompt(lang==='id'?'Menit jeda per jam (0‚Äì60)':'Break minutes per hour (0‚Äì60)', '15');
  if(b===null) return;
  const wi = Math.max(0, Math.min(60, parseFloat(w)||0));
  const bi = Math.max(0, Math.min(60, parseFloat(b)||0));
  if(wi+bi===0){ alert(lang==='id'?'Tidak valid. Total menit = 0':'Invalid. Total minutes = 0'); return; }
  customPresets.push({work:wi, break:bi});
  recalc();
}
document.addEventListener('click', (e)=>{
  if(e.target.classList.contains('btn-del')){
    const idx = parseInt(e.target.getAttribute('data-idx'),10);
    const customIdx = idx - defaultPresets.length;
    if(customIdx>=0 && customIdx < customPresets.length){
      customPresets.splice(customIdx,1);
      recalc();
    }
  }
});

/*** Print ***/
document.getElementById('btnPrint').addEventListener('click', ()=>window.print());

/*** Events ***/
document.getElementById('btnCalc').addEventListener('click', recalc);
document.getElementById('btnAddPreset').addEventListener('click', addPreset);
document.getElementById('langSel').addEventListener('change', (e)=>{ setLang(e.target.value); });
['ahv','targetA','shiftH','toolHours'].forEach(id=>{
  document.getElementById(id).addEventListener('input', recalc);
});

/*** Init ***/
function init(){
  buildCharts();
  setLang('id');
  recalc();
}
init();
</script>
</body>
</html>
