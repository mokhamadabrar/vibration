<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="description" content="Kalkulasi Batasan Paparan Getaran di Tempat Kerja ini adalah sesuai dengan aturan ketentuan PERMENKES No. 70 Tahun 2016 Indonesia, dan ISO 2631-1:1997 Mechanical vibration and shock - Evaluation of human exposure to whole-body vibration dan literatur pendukung">
  <title>Kalkulasi Paparan Vibrasi</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: #f4f7fa;
      color: #333;
      margin: 0; padding: 0;
    }
    .container {
      max-width: 820px;
      margin: 24px auto 12px auto;
      background: #fff;
      border-radius: 14px;
      box-shadow: 0 4px 16px #0001;
      padding: 24px 14px 32px 14px;
    }
    .lang-toggle {
      display: flex;
      justify-content: flex-end;
      margin-bottom: 8px;
    }
    .lang-toggle button {
      font-size: 13px;
      padding: 4px 13px;
      border-radius: 6px;
      border: none;
      background: #e7f3ff;
      color: #2861a7;
      margin-left: 8px;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.2s;
    }
    .lang-toggle button.active { background: #2861a7; color: #fff; }
    h2 {
      text-align: center;
      margin-bottom: 8px;
      color: #2c3e50;
      font-size: 1.7rem;
    }
    h2 span {
      display: block;
      font-size: 1rem;
      font-weight: normal;
      color: #555;
      margin-top: 5px;
    }
    .section {
      margin-bottom: 26px;
    }
    h3 {
      color: #1f4e79;
      font-size: 1.13rem;
      border-bottom: 2px solid #dbe9f4;
      padding-bottom: 5px;
      margin-top: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background-color: #fff;
      font-size: 1rem;
    }
    th, td {
      border: 1px solid #c2d3ea;
      padding: 9px 7px;
      text-align: center;
      vertical-align: middle;
      position: relative;
    }
    th {
      background-color: #dbe9f4;
      font-weight: bold;
      font-size: 1em;
    }
    tr:nth-child(even) { background-color: #f6fafd; }
    input[type="number"] {
      width: 100%;
      padding: 6px;
      box-sizing: border-box;
      text-align: center;
      font-size: 1em;
      border-radius: 5px;
      border: 1px solid #b9c7da;
    }
    .output { font-weight: bold; background-color: #eef; }
    .literature {
      background: #f8fafd;
      border: 1px solid #d6e7fa;
      padding: 13px 16px;
      border-radius: 5px;
      font-size: 0.98rem;
    }
    .literature li { margin-bottom: 7px; }
    .literature a { color: #175f9c; text-decoration: underline; }
    .tooltip {
      cursor: pointer; border-bottom: 1px dotted #555; text-decoration: none; position: relative;
    }
    .tooltip .tooltiptext {
      visibility: hidden; width: 250px;
      background: #0a376a; color: #fff;
      text-align: left; border-radius: 7px; padding: 10px 14px;
      position: absolute; z-index: 100;
      bottom: 120%; left: 50%; margin-left: -125px;
      opacity: 0; transition: opacity 0.3s;
      font-size: 13px;
    }
    .tooltip:hover .tooltiptext { visibility: visible; opacity: 1; }
    .status { padding: 2px 10px; border-radius: 8px; font-size: 12px; margin-left: 8px; }
    .aman { background: #d3f9d8; color: #137333; border: 1px solid #a4e9ae; }
    .tidakaman { background: #ffeaea; color: #d32f2f; border: 1px solid #ffcdd2; }
    .alert {
      color: #d32f2f; font-size: 14px; background: #ffeaea;
      border: 1px solid #ffcdd2; padding: 7px 15px;
      border-radius: 6px; display: none; margin: 13px 0 9px 0; text-align: left;
    }
    #chartVibration { background: #fff; max-width: 99%; margin: 0 auto 18px auto; }
    .risk-row { text-align: center; font-size: 1.08em; background: #f8f6ff; }
    .risk-box { display:inline-block; font-weight:600; border-radius:7px; padding:6px 14px;}
    .risk-low { background:#c9f3d4; color:#13643e; }
    .risk-mod { background:#fff9bf; color:#95710a; }
    .risk-high { background:#ffc7c4; color:#ab1919; }
    .infografik { text-align:center; margin-top:9px; }
    .infografik img { max-height:48px; margin:0 12px; vertical-align:middle; }
    /* Curve editor */
    #curveEditorWrap {margin: 30px 0 10px 0;}
    #curveSlider { width:100%; max-width:370px; }
    #curveChart { background:#fff; margin:0 auto 12px auto; max-width:390px; }
    /* Responsive */
    @media (max-width: 700px) {
      .container {padding: 7px 2vw 20px 2vw;}
      h2 { font-size: 1.15rem; }
      table { font-size: 0.96rem;}
      #curveChart, #chartVibration {max-width:99vw;}
    }
    footer {
      text-align:center; margin-top:38px; color:#888; font-size:15px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="lang-toggle">
      <button class="active" id="langID" onclick="setLang('id')">ID</button>
      <button id="langEN" onclick="setLang('en')">EN</button>
    </div>
    <h2>
      <span class="txt" data-id="title">Kalkulasi Paparan Vibrasi</span>
      <span class="txt" data-id="subtitle">Sesuai Permenkes No. 70 Th 2016 dan ISO 2631-1:1997</span>
    </h2>

    <div class="section">
      <h3 class="txt" data-id="input">INPUT</h3>
      <div id="alert" class="alert"></div>
      <table>
        <tr>
          <th class="txt" data-id="param">Parameter</th>
          <th class="txt" data-id="val">Nilai</th>
          <th class="txt" data-id="unit">Satuan</th>
          <th class="txt" data-id="desc">Deskripsi</th>
        </tr>
        <tr>
          <td><span class="tooltip txt" data-id="ax">Akselerasi RMS X
            <span class="tooltiptext txt" data-id="axTip">Rata-rata percepatan getaran arah X (m/s²).</span></span></td>
          <td><input type="number" id="ax" step="0.01" min="0" placeholder="0.00" oninput="hitung()"></td>
          <td>m/s²</td>
          <td></td>
        </tr>
        <tr>
          <td><span class="tooltip txt" data-id="ay">Akselerasi RMS Y
            <span class="tooltiptext txt" data-id="ayTip">Rata-rata percepatan getaran arah Y (m/s²).</span></span></td>
          <td><input type="number" id="ay" step="0.01" min="0" placeholder="0.00" oninput="hitung()"></td>
          <td>m/s²</td>
          <td></td>
        </tr>
        <tr>
          <td><span class="tooltip txt" data-id="az">Akselerasi RMS Z
            <span class="tooltiptext txt" data-id="azTip">Rata-rata percepatan getaran arah Z (m/s²).</span></span></td>
          <td><input type="number" id="az" step="0.01" min="0" placeholder="0.00" oninput="hitung()"></td>
          <td>m/s²</td>
          <td></td>
        </tr>
        <tr>
          <td><span class="tooltip txt" data-id="durasi">Durasi Pajanan
            <span class="tooltiptext txt" data-id="durasiTip">Lama paparan getaran (detik). 1 shift = 28,800 detik.</span></span></td>
          <td><input type="number" id="durasi" step="1" min="0" placeholder="0" oninput="hitung()"></td>
          <td class="txt" data-id="sec">detik</td>
          <td>1 Shift (8 Jam Kerja)</td>
        </tr>
        <tr>
          <td><span class="tooltip txt" data-id="rmsAmbang">Ambang Batas RMS
            <span class="tooltiptext txt" data-id="rmsAmbangTip">Nilai ambang RMS sesuai Permenkes No. 70 Th 2016 (0.5 m/s² untuk 8 jam).</span></span></td>
          <td><input type="number" id="rmsAmbang" step="0.01" min="0" placeholder="0.50" oninput="hitung()" value="0.5"></td>
          <td>m/s²</td>
          <td>Permenkes No. 70 Th 2016</td>
        </tr>
        <tr>
          <td><span class="tooltip txt" data-id="vdvAmbang">Ambang Batas VDV
            <span class="tooltiptext txt" data-id="vdvAmbangTip">NAB VDV KEPMENAKER (9.1 m/s<sup>1.75</sup> untuk 8 jam).</span></span></td>
          <td><input type="number" id="vdvAmbang" step="0.01" min="0" placeholder="9.10" oninput="hitung()" value="9.1"></td>
          <td>m/s<sup>1.75</sup></td>
          <td>Permenkes No. 70 Th 2016</td>
        </tr>
      </table>
    </div>

    <div class="section">
      <h3 class="txt" data-id="output">OUTPUT</h3>
      <table>
        <tr>
          <th class="txt" data-id="param">Parameter</th>
          <th class="txt" data-id="val">Nilai</th>
          <th class="txt" data-id="unit">Satuan</th>
          <th class="txt" data-id="desc">Deskripsi</th>
        </tr>
        <tr>
          <td><span class="tooltip txt" data-id="rmsResultan">RMS Resultan
            <span class="tooltiptext txt" data-id="rmsResultanTip">√[(1.4X)² + (1.4Y)² + (Z)²]</span>
          </span></td>
          <td id="rmsResultan" class="output"></td>
          <td>m/s²</td>
          <td><span id="rmsStatus"></span></td>
        </tr>
        <tr>
          <td><span class="tooltip txt" data-id="vdv">VDV (Vibration Dose Value)
            <span class="tooltiptext txt" data-id="vdvTip">VDV = RMS_resultan × durasi<sup>0.25</sup></span>
          </span></td>
          <td id="vdv" class="output"></td>
          <td>m/s<sup>1.75</sup></td>
          <td><span id="vdvStatus"></span></td>
        </tr>
        <tr>
          <td><span class="tooltip txt" data-id="durasiMax">Durasi Maksimum (RMS)
            <span class="tooltiptext txt" data-id="durasiMaxTip">Perkiraan waktu maksimum paparan RMS sampai NAB.</span>
          </span></td>
          <td id="durasiMax" class="output"></td>
          <td class="txt" data-id="hour">jam</td>
          <td></td>
        </tr>
        <tr class="risk-row">
          <td colspan="2"><span class="txt" data-id="riskTitle">Estimasi Risiko Kesehatan</span></td>
          <td colspan="2"><span id="riskLevel"></span></td>
        </tr>
      </table>
      <div class="infografik" id="infografikKerusakan" style="display:none;">
        <img src="https://cdn-icons-png.flaticon.com/128/4416/4416217.png" title="Spine" alt="Spine">
        <img src="https://cdn-icons-png.flaticon.com/128/9676/9676847.png" title="Heart" alt="Heart">
        <img src="https://cdn-icons-png.flaticon.com/128/2966/2966489.png" title="Stomach" alt="Stomach">
        <br>
        <span class="txt" data-id="riskOrgans">Organ tubuh berisiko: Tulang belakang, jantung, sistem pencernaan</span>
      </div>
    </div>

    <div style="max-width:640px; margin:32px auto;">
      <canvas id="chartVibration"></canvas>
    </div>

    <div id="curveEditorWrap">
      <h3 class="txt" data-id="curveTitle">Curve Editor: RMS vs Waktu Paparan</h3>
      <label for="curveSlider" class="txt" data-id="curveLabel">Ubah RMS untuk simulasi waktu paparan:</label>
      <input type="range" id="curveSlider" min="0.1" max="2.0" step="0.01" value="0.5" oninput="updateCurveChart()">
      <span id="curveVal" style="font-weight:bold;">0.50</span> m/s²
      <canvas id="curveChart" height="200"></canvas>
    </div>

    <div class="section">
      <h3 class="txt" data-id="restTitle">Waktu Istirahat Bergantian</h3>
      <table>
        <tr>
          <th class="txt" data-id="val">Nilai</th>
          <th>Skema</th>
          <th>Deskripsi</th>
        </tr>
        <tr>
          <td id="skemaA" class="output"></td>
          <td>Skema A</td>
          <td>&lt;15 m/s<sup>1.75</sup> (NAB VDV)</td>
        </tr>
        <tr>
          <td id="skemaB" class="output"></td>
          <td>Skema B</td>
          <td>&gt;15 m/s<sup>1.75</sup> (NAB VDV)</td>
        </tr>
        <tr>
          <td id="skemaC" class="output"></td>
          <td>Skema C</td>
          <td>&gt;15 m/s<sup>1.75</sup> (NAB VDV)</td>
        </tr>
        <tr>
          <td id="skemaD" class="output"></td>
          <td>Skema D</td>
          <td>=15 m/s<sup>1.75</sup> (NAB VDV)</td>
        </tr>
      </table>
    </div>

    <div class="section">
      <h3 class="txt" data-id="literature">Literatur</h3>
      <div class="literature">
        <ul>
          <li><a href="https://peraturan.bpk.go.id/Home/Details/112984/permenkes-no-70-tahun-2016" target="_blank"><strong>Permenkes No. 70 Tahun 2016</strong></a> – <span class="txt" data-id="lit1">Standar dan Batasan Paparan Getaran di Tempat Kerja</span>.</li>
          <li><a href="https://medialab.co.id/wp-content/uploads/2022/04/19-KepMenaker-RI-No-51Tahun-1999.pdf" target="_blank"><strong>KEPMENAKER No. 51/MEN/1999</strong></a> – <span class="txt" data-id="lit2">Nilai Ambang Batas Faktor Fisika di Tempat Kerja</span>.</li>
          <li><a href="https://www.iso.org/standard/7612.html" target="_blank"><strong>ISO 2631-1:1997</strong></a> – <span class="txt" data-id="lit3">Mechanical vibration and shock — Evaluation of human exposure to whole-body vibration</span>.</li>
          <li><a href="https://www.sciencedirect.com/book/9780123030405/handbook-of-human-vibration" target="_blank"><strong>Griffin, M.J. (1990)</strong></a> – Handbook of Human Vibration.</li>
          <li><a href="https://pubmed.ncbi.nlm.nih.gov/15915675/" target="_blank"><strong>Bovenzi, M. (2005)</strong></a> – <span class="txt" data-id="lit5">Health effects of mechanical vibration</span>.</li>
        </ul>
      </div>
    </div>
    <footer>
      <div style="padding:14px 0 0 0;">
        Created by<br>
        <strong>Ratu Avior, MSc in Environmental Engineering</strong><br>
        HTML design by Abrar
      </div>
    </footer>
  </div>

  <script>
    // --- Bahasa Ganda ---
    const textMap = {
      id: {
        title: "Kalkulasi Paparan Vibrasi",
        subtitle: "Sesuai Permenkes No. 70 Tahun 2016 dan ISO 2631-1:1997",
        input: "INPUT",
        output: "OUTPUT",
        param: "Parameter",
        val: "Nilai",
        unit: "Satuan",
        desc: "Deskripsi",
        ax: "Akselerasi RMS X", axTip: "Rata-rata percepatan getaran arah X (m/s²).",
        ay: "Akselerasi RMS Y", ayTip: "Rata-rata percepatan getaran arah Y (m/s²).",
        az: "Akselerasi RMS Z", azTip: "Rata-rata percepatan getaran arah Z (m/s²).",
        durasi: "Durasi Pajanan", durasiTip: "Lama paparan getaran (detik). 1 shift = 28,800 detik.",
        sec: "detik",
        rmsAmbang: "Ambang Batas RMS", rmsAmbangTip: "Nilai ambang RMS sesuai Permenkes No. 70 Tahun 2016 (0.5 m/s² untuk 8 jam).",
        vdvAmbang: "Ambang Batas VDV", vdvAmbangTip: "NAB VDV KEPMENAKER (9.1 m/s<sup>1.75</sup> untuk 8 jam).",
        rmsResultan: "RMS Resultan", rmsResultanTip: "√[(1.4X)² + (1.4Y)² + (Z)²]",
        vdv: "VDV (Vibration Dose Value)", vdvTip: "VDV = RMS_resultan × durasi<sup>0.25</sup>",
        durasiMax: "Durasi Maksimum (RMS)", durasiMaxTip: "Perkiraan waktu maksimum paparan RMS sampai NAB.",
        hour: "jam",
        riskTitle: "Estimasi Risiko Kesehatan",
        riskLow: "Rendah (Probabilitas keluhan &lt;10%)",
        riskMod: "Sedang (Probabilitas keluhan 10–30%)",
        riskHigh: "Tinggi (Probabilitas keluhan &gt;30%)",
        riskOrgans: "Organ tubuh berisiko: Tulang belakang, jantung, sistem pencernaan",
        curveTitle: "Curve Editor: RMS vs Waktu Paparan",
        curveLabel: "Ubah RMS untuk simulasi waktu paparan:",
        restTitle: "Waktu Istirahat Bergantian",
        literature: "Literatur",
        lit1: "Standar dan Batasan Paparan Getaran di Tempat Kerja",
        lit2: "Nilai Ambang Batas Faktor Fisika di Tempat Kerja",
        lit3: "Evaluasi paparan getaran tubuh secara keseluruhan",
        lit5: "Dampak kesehatan getaran mekanis"
      },
      en: {
        title: "Vibration Exposure Calculation",
        subtitle: "According to Indonesian Permenkes No.70/2016 and ISO 2631-1:1997",
        input: "INPUT",
        output: "OUTPUT",
        param: "Parameter",
        val: "Value",
        unit: "Unit",
        desc: "Description",
        ax: "RMS Acceleration X", axTip: "Mean vibration acceleration on X axis (m/s²).",
        ay: "RMS Acceleration Y", ayTip: "Mean vibration acceleration on Y axis (m/s²).",
        az: "RMS Acceleration Z", azTip: "Mean vibration acceleration on Z axis (m/s²).",
        durasi: "Exposure Duration", durasiTip: "Exposure duration (seconds). 1 shift = 28,800 s.",
        sec: "sec",
        rmsAmbang: "RMS Threshold", rmsAmbangTip: "RMS limit per Permenkes No. 70 Tahun 2016 (0.5 m/s² for 8 hours).",
        vdvAmbang: "VDV Threshold", vdvAmbangTip: "NAB VDV (9.1 m/s<sup>1.75</sup> for 8 hours).",
        rmsResultan: "Resultant RMS", rmsResultanTip: "√[(1.4X)² + (1.4Y)² + (Z)²]",
        vdv: "VDV (Vibration Dose Value)", vdvTip: "VDV = RMS_resultant × duration<sup>0.25</sup>",
        durasiMax: "Max Duration (RMS)", durasiMaxTip: "Estimated maximum RMS exposure duration to reach threshold.",
        hour: "hours",
        riskTitle: "Health Risk Estimate",
        riskLow: "Low (Complaint probability &lt;10%)",
        riskMod: "Moderate (Complaint probability 10–30%)",
        riskHigh: "High (Complaint probability &gt;30%)",
        riskOrgans: "At-risk organs: Spine, heart, digestive system",
        curveTitle: "Curve Editor: RMS vs Exposure Time",
        curveLabel: "Adjust RMS for exposure time simulation:",
        restTitle: "Alternate Rest Scheme",
        literature: "References",
        lit1: "Standards and Limits of Vibration Exposure in the Workplace",
        lit2: "Threshold Limit Values for Physical Factors in the Workplace",
        lit3: "Whole-body vibration exposure evaluation",
        lit5: "Health effects of mechanical vibration"
      }
    };

    function setLang(lang) {
      document.getElementById('langID').classList.toggle('active', lang === 'id');
      document.getElementById('langEN').classList.toggle('active', lang === 'en');
      document.body.setAttribute('lang', lang);
      document.querySelectorAll('.txt').forEach(el => {
        let key = el.getAttribute('data-id');
        if (key && textMap[lang][key]) el.innerHTML = textMap[lang][key];
      });
      // Satuan detik/jam
      document.querySelectorAll('.txt[data-id="sec"]').forEach(e => e.innerHTML = textMap[lang].sec);
      document.querySelectorAll('.txt[data-id="hour"]').forEach(e => e.innerHTML = textMap[lang].hour);
    }

    // --- Perhitungan, Risk, Chart, Curve ---
    let chartVibration = null, curveChart = null;
    function hitung() {
      // Input
      const ax = parseFloat(document.getElementById("ax").value) || 0;
      const ay = parseFloat(document.getElementById("ay").value) || 0;
      const az = parseFloat(document.getElementById("az").value) || 0;
      const durasi = parseFloat(document.getElementById("durasi").value) || 0;
      const rmsAmbang = parseFloat(document.getElementById("rmsAmbang").value) || 0;
      const vdvAmbang = parseFloat(document.getElementById("vdvAmbang").value) || 0;
      let alertMsg = "";
      if (ax < 0 || ay < 0 || az < 0 || durasi < 0 || rmsAmbang < 0 || vdvAmbang < 0) {
        alertMsg = (document.body.lang === 'en')
          ? "Input cannot be negative. Please check your data."
          : "Nilai input tidak boleh negatif. Silakan cek kembali data yang Anda masukkan.";
      }
      document.getElementById("alert").style.display = alertMsg ? "block" : "none";
      document.getElementById("alert").innerText = alertMsg;
      if (alertMsg) {
        [
          "rmsResultan", "vdv", "durasiMax", "skemaA", "skemaB", "skemaC", "skemaD",
          "rmsStatus", "vdvStatus", "riskLevel"
        ].forEach(id => document.getElementById(id).innerText = "");
        updateChart(0, rmsAmbang, 0, vdvAmbang, 0, 0);
        document.getElementById('infografikKerusakan').style.display = 'none';
        return;
      }
      const rmsResultan = Math.sqrt(Math.pow(1.4 * ax, 2) + Math.pow(1.4 * ay, 2) + Math.pow(az, 2));
      const vdv = rmsResultan * Math.pow(durasi, 0.25);
      const durasiMax = (rmsResultan === 0) ? 0 : Math.pow((rmsAmbang / rmsResultan), 4) / 3600;
      const skemaA = rmsResultan * Math.pow(11520, 0.25);
      const skemaB = rmsResultan * Math.pow(28800, 0.25);
      const skemaC = rmsResultan * Math.pow(14400, 0.25);
      const skemaD = rmsResultan * Math.pow(12600, 0.25);
      document.getElementById("rmsResultan").innerText = rmsResultan.toFixed(4);
      document.getElementById("vdv").innerText = vdv.toFixed(4);
      document.getElementById("durasiMax").innerText = durasiMax.toFixed(4);
      document.getElementById("skemaA").innerText = skemaA.toFixed(4);
      document.getElementById("skemaB").innerText = skemaB.toFixed(4);
      document.getElementById("skemaC").innerText = skemaC.toFixed(4);
      document.getElementById("skemaD").innerText = skemaD.toFixed(4);
      // Status Aman/Tidak Aman RMS
      let rmsStatusText = "", vdvStatusText = "";
      let rmsAlarm = rmsAmbang && rmsResultan > rmsAmbang, vdvAlarm = vdvAmbang && vdv > vdvAmbang;
      if (rmsAmbang && rmsResultan > 0) {
        rmsStatusText = rmsResultan <= rmsAmbang
          ? '<span class="status aman">'+(document.body.lang==='en'?'Safe':'Aman')+'</span>'
          : '<span class="status tidakaman">'+(document.body.lang==='en'?'Unsafe':'Tidak Aman')+'</span>';
      }
      if (vdvAmbang && vdv > 0) {
        vdvStatusText = vdv <= vdvAmbang
          ? '<span class="status aman">'+(document.body.lang==='en'?'Safe':'Aman')+'</span>'
          : '<span class="status tidakaman">'+(document.body.lang==='en'?'Unsafe':'Tidak Aman')+'</span>';
      }
      document.getElementById("rmsStatus").innerHTML = rmsStatusText;
      document.getElementById("vdvStatus").innerHTML = vdvStatusText;

      // --- Risk Level (berdasarkan Griffin/Bovenzi) ---
      // Referensi: >0.5 m/s² (8 jam) risiko keluhan naik signifikan, probabilitas keluhan rendah <0.4, sedang 0.4–0.8, tinggi >0.8
      let risk = '', riskClass = '', riskVal = rmsResultan;
      if (riskVal < 0.4) { risk = textMap[document.body.lang||'id'].riskLow; riskClass = 'risk-low'; }
      else if (riskVal < 0.8) { risk = textMap[document.body.lang||'id'].riskMod; riskClass = 'risk-mod'; }
      else { risk = textMap[document.body.lang||'id'].riskHigh; riskClass = 'risk-high'; }
      document.getElementById("riskLevel").innerHTML = '<span class="risk-box '+riskClass+'">'+risk+'</span>';

      // Infografik jika melebihi NAB
      document.getElementById('infografikKerusakan').style.display = (rmsAlarm || vdvAlarm) ? 'block' : 'none';

      // Update Chart (dengan alarm warna merah jika ada exceed)
      updateChart(rmsResultan, rmsAmbang, vdv, vdvAmbang, rmsAlarm, vdvAlarm);
    }

    function updateChart(rmsResultan, rmsAmbang, vdv, vdvAmbang, rmsAlarm, vdvAlarm) {
      const ctx = document.getElementById('chartVibration').getContext('2d');
      if (chartVibration) chartVibration.destroy();
      chartVibration = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: [
            document.body.lang === 'en' ? "Resultant RMS" : "RMS Resultan",
            document.body.lang === 'en' ? "NAB RMS" : "NAB RMS",
            "VDV", "NAB VDV"
          ],
          datasets: [{
            label: 'Nilai',
            data: [rmsResultan, rmsAmbang, vdv, vdvAmbang],
            backgroundColor: [
              rmsAlarm ? '#ff4545' : '#7ec1f2',
              '#e9e9e9',
              vdvAlarm ? '#ff4545' : '#77dd77',
              '#e9e9e9'
            ]
          }]
        },
        options: {
          plugins: { legend: { display: false } },
          scales: {
            y: { beginAtZero: true, title: { display: false } }
          }
        }
      });
    }

    // --- Curve Editor: RMS vs Durasi ---
    function updateCurveChart() {
      let rms = parseFloat(document.getElementById('curveSlider').value);
      document.getElementById('curveVal').innerText = rms.toFixed(2);
      let hours = Array.from({length: 17}, (_, i) => i); // 0-16 jam
      let durations = hours.map(h => h * 3600);
      let nab = 0.5, v = rms;
      let ratio = nab / v;
      let maxJam = (v > 0) ? Math.pow(ratio, 4) : 0;
      let chartData = durations.map(t => v * Math.pow(t, 0.25));
      let nabVdv = 9.1;
      let nabArr = durations.map(() => nabVdv);
      if (curveChart) curveChart.destroy();
      curveChart = new Chart(document.getElementById('curveChart').getContext('2d'), {
        type: 'line',
        data: {
          labels: hours.map(h => (document.body.lang==='en'?h+'h':h+' jam')),
          datasets: [
            {
              label: document.body.lang==='en' ? 'VDV (Estimated)' : 'VDV (Estimasi)',
              data: chartData,
              fill: false, borderColor: '#2367c1', tension: 0.22,
              pointRadius: 2
            },
            {
              label: 'NAB VDV',
              data: nabArr,
              fill: false, borderColor: '#d32f2f', borderDash: [7,5], pointRadius: 0
            }
          ]
        },
        options: {
          plugins: { legend: { display: true }},
          scales: {
            y: { title: { display: true, text: 'VDV (m/s^1.75)' }, beginAtZero:true }
          }
        }
      });
    }

    // --- Init & Event Binding ---
    window.onload = function() {
      setLang('id');
      hitung();
      updateCurveChart();
      document.getElementById('curveSlider').addEventListener('input', updateCurveChart);
      document.getElementById('ax').addEventListener('input', hitung);
      document.getElementById('ay').addEventListener('input', hitung);
      document.getElementById('az').addEventListener('input', hitung);
      document.getElementById('durasi').addEventListener('input', hitung);
      document.getElementById('rmsAmbang').addEventListener('input', hitung);
      document.getElementById('vdvAmbang').addEventListener('input', hitung);
    }
  </script>
</body>
</html>
